<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
   
    <style>
        .container {
            margin-top: 20px;
        }
        .form-control, .form-select {
            margin-bottom: 10px;
        }
        .table-responsive {
            overflow-x: auto; /* Allows horizontal scrolling on small screens */
        }
        .form-row {
            margin-bottom: 15px;
        }
        .btn {
            margin-top: 10px;
        }
        .btn-margin-bottom {
        margin-bottom: 20px; /* Adjust this value as needed */
    }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4">Test</h2>

        <h3 class="mb-4">Record List</h3>
        <button type="button" class="btn btn-primary btn-margin-bottom" data-toggle="modal" data-target="#addRecordModal">Add New Record</button>

        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <!--<th>Role</th>-->
                        <th>Contact</th>
                        <!--<th>Address</th>-->
                        <th>Home</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="recordList">
                    <!-- Records will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Bootstrap Modal for Adding Record -->
    <div class="modal fade" id="addRecordModal" tabindex="-1" role="dialog" aria-labelledby="addRecordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRecordModalLabel">Add a New Record</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="crudForm">
                        <div class="form-row">
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="nameInput" placeholder="Name" required>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="roleInput" placeholder="Role">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="contactInput" placeholder="Contact">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="addressInput" placeholder="Address">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <select id="homeSelect" class="form-select">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="addRecordBtn" class="btn btn-primary">Add Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Modal for Editing Record -->
    <div class="modal fade" id="editRecordModal" tabindex="-1" role="dialog" aria-labelledby="editRecordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRecordModalLabel">Edit Record</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editCrudForm">
                        <input type="hidden" id="editRecordId">
                        <div class="form-row">
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="editNameInput" placeholder="Name" required>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="editRoleInput" placeholder="Role">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="editContactInput" placeholder="Contact">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <input type="text" class="form-control" id="editAddressInput" placeholder="Address">
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <select id="editHomeSelect" class="form-select">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="editRecordBtn" class="btn btn-primary">Update Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies (Popper.js and jQuery) CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Your script file -->
    
</body>

<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabaseUrl = 'https://oqvxnlknzysijtzhbiyh.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xdnhubGtuenlzaWp0emhiaXloIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyMjY3MDMyNSwiZXhwIjoyMDM4MjQ2MzI1fQ.jIyioDs9ZgnLY4xs7rl0mFMU3Icppl5MzFf_87mzluU';
const supabase = createClient(supabaseUrl, supabaseKey);

const recordList = document.getElementById('recordList');
const nameInput = document.getElementById('nameInput');
const roleInput = document.getElementById('roleInput');
const contactInput = document.getElementById('contactInput');
const addressInput = document.getElementById('addressInput');
const homeSelect = document.getElementById('homeSelect');

const editRecordId = document.getElementById('editRecordId');
const editNameInput = document.getElementById('editNameInput');
const editRoleInput = document.getElementById('editRoleInput');
const editContactInput = document.getElementById('editContactInput');
const editAddressInput = document.getElementById('editAddressInput');
const editHomeSelect = document.getElementById('editHomeSelect');

// Load records from Supabase
async function loadRecords() {
    const { data, error } = await supabase
        .from('musalli')
        .select('*, home(home_name)');
    if (error) {
        console.error('Error loading records:', error);
        return;
    }
    recordList.innerHTML = '';
    data.forEach((record) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${record.name}</td>
            <td>${record.contact}</td>
            <td>${record.home.home_name}</td>
            <td>
                <button class="btn btn-warning btn-sm" id="Edit(${record.id})">Edit</button>
                <button class="btn btn-danger btn-sm" id="Delete(${record.id})">Delete</button>
            </td>
        `;
        recordList.appendChild(row);
    });
}

// Load homes from Supabase
async function loadHomes() {
    const { data, error } = await supabase
        .from('home')
        .select('*');
    if (error) {
        console.error('Error loading homes:', error);
        return;
    }
    homeSelect.innerHTML = '<option value="">Select a home</option>';
    editHomeSelect.innerHTML = '<option value="">Select a home</option>';
    data.forEach((home) => {
        const option = document.createElement('option');
        option.value = home.id;
        option.textContent = home.home_name;
        homeSelect.appendChild(option);
        editHomeSelect.appendChild(option.cloneNode(true));
    });
}

// Add new record
async function addRecord() {
    const name = nameInput.value.trim();
    const role = roleInput.value.trim();
    const contact = contactInput.value.trim();
    const address = addressInput.value.trim();
    const homeId = homeSelect.value;

    if (name) {
        const { data, error } = await supabase
            .from('musalli')
            .insert([{ name, role, contact, address, home_id: homeId }]);
        if (error) {
            console.error('Error adding record:', error);
            return;
        }
        // Reset form fields and close the modal
        nameInput.value = '';
        roleInput.value = '';
        contactInput.value = '';
        addressInput.value = '';
        homeSelect.value = '';
        $('#addRecordModal').modal('hide'); // Hide the modal
        loadRecords(); // Reload records
    } else {
        alert('Name field is required.');
    }
}

// Edit a record
async function editRecord(id) {
    const {data, error } = await supabase
        .from('musalli')
        .select('*, home(home_name)')
        .eq('id', id)
        .single();
    if (error) {
        console.error('Error loading record for edit:', error);
        return;
 }
    editRecordId.value = data.id;
    editNameInput.value = data.name;
    editRoleInput.value = data.role;
    editContactInput.value = data.contact;
    editAddressInput.value = data.address;
    editHomeSelect.value = data.home_id;
    $('#editRecordModal').modal('show'); // Show the edit modal
}

// Update a record
async function updateRecord() {
    const id = editRecordId.value;
    const name = editNameInput.value.trim();
    const role = editRoleInput.value.trim();
    const contact = editContactInput.value.trim();
    const address = editAddressInput.value.trim();
    const homeId = editHomeSelect.value;

    if (name) {
        const {data, error } = await supabase
            .from('musalli')
            .update({ name, role, contact, address, home_id: homeId })
            .eq('id', id);
        if (error) {
            console.error('Error updating record:', error);
            return;
        }
        // Reset form fields and close the modal
        editNameInput.value = '';
        editRoleInput.value = '';
        editContactInput.value = '';
        editAddressInput.value = '';
        editHomeSelect.value = '';
        $('#editRecordModal').modal('hide'); // Hide the modal
        loadRecords(); // Reload records
    } else {
        alert('Name field is required.');
    }
}

// Delete a record
async function deleteRecord(id) {
    if (confirm('Are you sure you want to delete this record?')) {
        const {data, error } = await supabase
            .from('musalli')
            .delete()
            .eq('id', id);
        if (error) {
            console.error('Error deleting record:', error);
            return;
        }
        loadRecords(); // Reload records
    }
}

const buttons = document.getElementsByClassName('btn-warning');

// Iterate over each button and add an event listener
Array.from(buttons).forEach(button => {
    button.addEventListener('click', () => {
        // Replace '1' with dynamic data if needed, such as using data attributes
        editRecord(1);
    });
});

// Event listeners
document.getElementById('addRecordBtn').addEventListener('click', () => {
    addRecord();
});

document.getElementById('editRecordBtn').addEventListener('click', () => {
    updateRecord();
});

// Load homes and records on page load
loadHomes();
loadRecords();
<script>
</html>
